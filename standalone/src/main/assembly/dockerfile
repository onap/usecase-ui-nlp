# hadolint ignore=DL3007
FROM python:3.11.0
#这个基于实际服务器目录自行改动，以下都是在这个目录下进行
WORKDIR /home/nlp/uuihome/uui
#把和Dockerfile一个目录下的更新之后的requirements.txt拷贝到指定目录下
COPY requirements.txt   /home/nlp/uuihome/uui/requirements.txt
#用于更新软件包列表并安装Ruby及其相关开发库的
RUN apt-get update && apt-get install -y ruby zlib1g zlib1g.dev libjpeg-dev

RUN groupadd uui -g 1000 && \
    useradd -u 1000 -d /home/nlp/uuihome/uui -g uui -s /bin/bash uui && \
    DEBIAN_FRONTEND=noninteractive apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y \
      build-essential \
      curl \
      python3-dev \
      python3-pip \
      unzip && \
    pip install --upgrade setuptools && \
    pip install --upgrade pip && \
    pip install wheel && \
    pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple && \
    DEBIAN_FRONTEND=noninteractive apt-get remove --purge -y \
      build-essential \
      curl \
      python3-dev \
      unzip && \
    DEBIAN_FRONTEND=noninteractive apt-get autoremove --purge -y && \
    apt-get clean

#将项目中的scripts文件中的所有文件和目录复制到/home/nlp/uuihome/uui/下，保证此时的scripts和Dockerfile在同一级目录下
COPY scripts /home/nlp/uuihome/uui/
#将和Dockerfile文件一个目录下的run.sh复制到指定目录下
COPY assembly/run.sh  /home/nlp/uuihome/uui/run.sh

RUN chown -R uui:uui /home/nlp/uuihome/uui
USER uui
#当 Docker 容器启动时，它会执行 /home/nlp/uuihome/uui/run.sh 脚本
ENTRYPOINT ["/home/nlp/uuihome/uui/run.sh"]

